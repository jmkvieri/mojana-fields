# lamojana (Collective labour and sustainability of pre-Hispanic field systems in La Mojana)

This repository contains the data and scripts used in the manuscript:

```         
  Vieri, J., Montejo Gaitán, F., Carrero-Pazos, M., Martinón-Torres, M., submitted. Collective labour and sustainability of pre-Hispanic field systems in La Mojana

```

All Python scripts were executed within the QGIS Python Console. The workflow therefore requires a working QGIS installation and access to the associated QGIS project environment (see below for a detailed description of software environment).

# Structure

The user can download the whole contents in bulk, with all of the analyses designed to be run on a script-by-script basis. 

The repository is organised into three main folders, with the folder scripts further subdivided into subsections according to the order in which each step appears in the Methods section of the paper:

| Directory | Subdirectory | Description |
| :--- | :--- | :--- |
| `outputs` | | All outputs generated by the full pipeline|
|  | `/data`| Data generated by the analyses|
|  |`/figures` | Final figures in manuscript |
|  |`/final_shapefiles` | Final shapefiles used for making the final figures|
|  | `/tables`| Final tables in manuscript|
|  | `/temp`| Temporary files generated and used during analysis|
| `scripts` | | All scripts used for analysis|
|  |`/01_cartography` | Semi-automated part of cartography |
|  |`/02_dimensions` | Extracting camellon dimensions |
|  |`/03_cluster` | Unsupervised clustering |
|  |`/04_population` | Population estimates |
|  |`/05_volumes-labour` | Volume and labour cost estimates |
|  |`/06_centrality` | Centrality analysis|
|  |`/S2_surviving_height` | Computing surviving camellon heights |
| `spatial_data` | | |
|  |`/DEM` | Digital Elevation Model (DEM)|
|  |`/shapefiles` | Shapefiles used for analysis |

# Requirements

## Software environment

### QGIS / PyQGIS (Python scripts)
All Python scripts are intended to be run **inside the QGIS Python Console (PyQGIS)**, not as standalone Python scripts.

- **QGIS**: 3.30.3 (“’s-Hertogenbosch”)
- **Python**: 3.9.5
- **GDAL (bundled with QGIS)**: 3.3.2

#### Required QGIS components
- **Processing** framework enabled
- **GDAL** provider enabled (for tools invoked via `processing.run("gdal:…")`)
- **Native QGIS** provider enabled (for tools invoked via `processing.run("native:…")`)

### R scripts
- **R**: 4.5.1
- **RStudio**: 2025.09.1

### Operating system (tested)
macOS 13 (Ventura)

---

## Input data and project assumptions

### QGIS project context
Scripts assume a **saved QGIS project** (`.qgz`) is open when running, because paths are computed relative to:

- `QgsProject.instance().fileName()`

If the project has not been saved in the repository root, this path can be empty and file loading will fail.

### Folder structure
Scripts assume the repository folder layout exactly as described in the **Structure** section, and that required layers exist at the specified relative paths (e.g., `spatial_data/DEM/...`, `outputs/temp/...`). Scripts in folder `01_cartography` require the user to use their own API to download satellite imagery tiles as specified within the script.

### Coordinate reference systems
For correct distance buffering and raster-to-meter assumptions, inputs should use the expected CRS and the DEM should have an appropriate geotransform (meter-based units). Here, projection EPSG:3116 was used.

---

## Python Session Info
Captured from the QGIS Python Console:

```
QGIS version: 3.30.3-'s-Hertogenbosch
Python: 3.9.5
Qt version: 5.15.2
PyQt version: 5.15.4
GDAL: 3.3.2
- Python packages:
  - numpy==1.20.1
  - pandas==1.3.3
  - shapely==1.7.0
  - pyproj==3.2.0
  - fiona==1.8.13.post1
  - rasterio==1.1.5
  - geopandas==0.8.1
  - matplotlib==3.3.0
```

## R Session info

```
attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] lubridate_1.9.4 forcats_1.0.1   stringr_1.5.2   dplyr_1.1.4     purrr_1.1.0     readr_2.1.6     tidyr_1.3.1     tibble_3.3.0    ggplot2_4.0.0   tidyverse_2.0.0
[11] igraph_2.2.0    sf_1.0-22       here_1.0.2      terra_1.8-93    httr_1.4.7     

loaded via a namespace (and not attached):
 [1] generics_0.1.4     class_7.3-23       KernSmooth_2.23-26 stringi_1.8.7      hms_1.1.4          magrittr_2.0.4     grid_4.5.1         timechange_0.3.0  
 [9] RColorBrewer_1.1-3 rprojroot_2.1.1    e1071_1.7-16       DBI_1.2.3          scales_1.4.0       codetools_0.2-20   textshaping_1.0.4  cli_3.6.5         
[17] rlang_1.1.6        units_1.0-0        withr_3.0.2        tools_4.5.1        tzdb_0.5.0         vctrs_0.6.5        R6_2.6.1           proxy_0.4-27      
[25] lifecycle_1.0.4    classInt_0.4-11    ragg_1.5.0         pkgconfig_2.0.3    pillar_1.11.1      gtable_0.3.6       glue_1.8.0         Rcpp_1.1.0        
[33] systemfonts_1.3.1  tidyselect_1.2.1   rstudioapi_0.18.0  farver_2.1.2       labeling_0.4.3     compiler_4.5.1     S7_0.2.0  
```


## Funding

This project has received funding from the European Union’s Horizon 2020 research and innovation programme (Grant agreement No. 101021480, REVERSEACTION project).
